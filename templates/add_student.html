<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><title>Öğrenci Ekle</title></head>
<body>
  <h2>Öğrenci Ekle</h2>
  <a href="{{ url_for('dashboard') }}">Geri</a>
  <form method="POST">
    <label>İsim*</label><input name="name" required><br>
    <label>Telefon</label><input name="phone"><br>
    <label>Okul No</label><input name="school_no"><br>

    <label>Fakülte</label>
    <select name="faculty" id="faculty" onchange="fillDepartments()">
      <option value="">(Seçiniz)</option>
      {% for fac, deps in faculties.items() %}
      <option value="{{ fac }}">{{ fac }}</option>
      {% endfor %}
    </select><br>

    <label>Bölüm</label>
    <select name="department" id="department">
      <option value="">(Önce fakülte seç)</option>
    </select><br>

    <label>Durum</label>
    <select name="status">
      <option value="cozulmedi">çözülmedi</option>
      <option value="cozuldu">çözüldü</option>
    </select><br>

    <button type="submit">Ekle</button>
  </form>

  <script>
  const FACULTY_DEPARTMENTS = {{ faculties|tojson }};
  function fillDepartments() {
    const f = document.getElementById('faculty').value;
    const d = document.getElementById('department');
    d.innerHTML = "";
    const list = FACULTY_DEPARTMENTS[f] || [];
    if(list.length === 0){
      d.innerHTML = '<option value="">(Bölüm yok)</option>';
      return;
    }
    list.forEach(function(item){
      const opt = document.createElement('option');
      opt.value = item; opt.text = item;
      d.appendChild(opt);
    });
  }
  </script>

  {% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}
    <ul>
    {% for cat, msg in msgs %}
      <li>[{{cat}}] {{ msg }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}
</body>
</html>
