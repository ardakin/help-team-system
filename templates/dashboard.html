<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><title>Dashboard</title></head>
<body>
  <h2>Dashboard</h2>
  <a href="{{ url_for('logout') }}">Çıkış</a> |
  <a href="{{ url_for('add_student') }}">Öğrenci Ekle</a> |
  <a href="{{ url_for('main_screen') }}">Özet</a>

  <form method="GET" action="{{ url_for('dashboard') }}">
    Arama: <input type="text" name="q" value="{{ q or '' }}">
    Durum:
    <select name="status">
      <option value="">(Hepsi)</option>
      <option value="cozulmedi" {{ 'selected' if status=='cozulmedi' else '' }}>çözülmedi</option>
      <option value="cozuldu"   {{ 'selected' if status=='cozuldu' else '' }}>çözüldü</option>
    </select>
    Fakülte:
    <input type="text" name="faculty" value="{{ faculty or '' }}">
    Bölüm:
    <input type="text" name="department" value="{{ department or '' }}">
    Ekleyen:
    <select name="added_by">
      <option value="">(Hepsi)</option>
      {% for who in added_by_options %}
      <option value="{{ who }}" {{ 'selected' if added_by==who else '' }}>{{ who }}</option>
      {% endfor %}
    </select>
    <button type="submit">Filtrele</button>
  </form>

  <hr>
  <table border="1" cellspacing="0" cellpadding="6">
    <tr>
      <th>ID</th><th>İsim</th><th>Telefon</th><th>Okul No</th>
      <th>Fakülte</th><th>Bölüm</th><th>Durum</th><th>Ekleyen</th><th>İşlem</th>
    </tr>
    {% for s in students %}
    <tr>
      <td>{{ s.id }}</td>
      <td><a href="{{ url_for('view_student', id=s.id) }}">{{ s.name }}</a></td>
      <td>{{ s.phone or '' }}</td>
      <td>{{ s.school_no or '' }}</td>
      <td>{{ s.faculty or '' }}</td>
      <td>{{ s.department or '' }}</td>
      <td>{{ s.status }}</td>
      <td>{{ s.added_by or '' }}</td>
      <td>
        <a href="{{ url_for('edit_student', id=s.id) }}">Düzenle</a>
        <form method="POST" action="{{ url_for('delete_student', id=s.id) }}" style="display:inline" onsubmit="return confirm('Silinsin mi?');">
          <button type="submit">Sil</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>

  {% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}
    <ul>
    {% for cat, msg in msgs %}
      <li>[{{cat}}] {{ msg }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}
</body>
</html>
