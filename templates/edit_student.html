<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><title>Öğrenci Düzenle</title></head>
<body>
  <a href="{{ url_for('view_student', id=student.id) }}">Geri</a>
  <h2>Öğrenci Düzenle: {{ student.name }}</h2>
  <form method="POST">
    <label>İsim*</label><input name="name" value="{{ student.name }}" required><br>
    <label>Telefon</label><input name="phone" value="{{ student.phone or '' }}"><br>
    <label>Okul No</label><input name="school_no" value="{{ student.school_no or '' }}"><br>

    <label>Fakülte</label>
    <select name="faculty" id="faculty" onchange="fillDepartments()">
      <option value="">(Seçiniz)</option>
      {% for fac, deps in faculties.items() %}
      <option value="{{ fac }}" {{ 'selected' if student.faculty==fac else '' }}>{{ fac }}</option>
      {% endfor %}
    </select><br>

    <label>Bölüm</label>
    <select name="department" id="department">
      {% set deps = faculties.get(student.faculty, []) %}
      {% if deps %}
        {% for d in deps %}
          <option value="{{ d }}" {{ 'selected' if student.department==d else '' }}>{{ d }}</option>
        {% endfor %}
      {% else %}
        <option value="">(Bölüm yok)</option>
      {% endif %}
    </select><br>

    <label>Durum</label>
    <select name="status">
      <option value="cozulmedi" {{ 'selected' if student.status=='cozulmedi' else '' }}>çözülmedi</option>
      <option value="cozuldu"   {{ 'selected' if student.status=='cozuldu' else '' }}>çözüldü</option>
    </select><br>

    <button type="submit">Kaydet</button>
  </form>

  <script>
  const FACULTY_DEPARTMENTS = {{ faculties|tojson }};
  function fillDepartments() {
    const f = document.getElementById('faculty').value;
    const d = document.getElementById('department');
    d.innerHTML = "";
    const list = FACULTY_DEPARTMENTS[f] || [];
    if(list.length === 0){
      d.innerHTML = '<option value="">(Bölüm yok)</option>';
      return;
    }
    list.forEach(function(item){
      const opt = document.createElement('option');
      opt.value = item; opt.text = item;
      d.appendChild(opt);
    });
  }
  </script>

  {% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}
    <ul>
    {% for cat, msg in msgs %}
      <li>[{{cat}}] {{ msg }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}
</body>
</html>
