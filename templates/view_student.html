<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><title>Öğrenci Detay</title></head>
<body>
  <a href="{{ url_for('dashboard') }}">Geri</a>
  <h2>{{ student.name }} (ID: {{ student.id }})</h2>
  <p>Telefon: {{ student.phone or '' }}</p>
  <p>Okul No: {{ student.school_no or '' }}</p>
  <p>Fakülte: {{ student.faculty or '' }}</p>
  <p>Bölüm: {{ student.department or '' }}</p>
  <p>Durum: <b>{{ student.status }}</b></p>
  <p>Ekleyen: {{ student.added_by or '' }} | Oluşturma: {{ student.created_at }}</p>

  <h3>Durum / Not</h3>
  <form method="POST" action="{{ url_for('add_note', id=student.id) }}">
    <label>Yeni Durum:</label>
    <select name="status">
      <option value="cozulmedi" {{ 'selected' if student.status=='cozulmedi' else '' }}>çözülmedi</option>
      <option value="cozuldu"   {{ 'selected' if student.status=='cozuldu' else '' }}>çözüldü</option>
    </select><br>
    <label>Not:</label><br>
    <textarea name="note" rows="3" cols="50"></textarea><br>
    <button type="submit">Kaydet</button>
  </form>

  <h3>Notlar</h3>
  <ul>
    {% for n in notes %}
    <li>
      <b>{{ n.author }}</b> - {{ n.created_at }}<br>
      {{ n.text }}
      <form method="POST" action="{{ url_for('delete_note', note_id=n.id) }}" style="display:inline" onsubmit="return confirm('Silinsin mi?')">
        <button type="submit">Notu Sil</button>
      </form>
    </li>
    {% else %}
    <li>Not yok.</li>
    {% endfor %}
  </ul>

  {% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}
    <ul>
    {% for cat, msg in msgs %}
      <li>[{{cat}}] {{ msg }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}
</body>
</html>
